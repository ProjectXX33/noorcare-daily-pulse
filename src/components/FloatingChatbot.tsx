import React, { useState, useRef, useEffect } from 'react';
import { MessageCircle, Bot, Send, Minimize2, Maximize2, X, ShoppingCart, Plus, FileText, Palette, TrendingUp, Users, Settings, Package, User, Phone, MapPin, CreditCard, Search, Zap } from 'lucide-react';
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Badge } from '@/components/ui/badge';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Textarea } from '@/components/ui/textarea';
import { useAuth } from '@/contexts/AuthContext';
import { useNavigate, useLocation } from 'react-router-dom';
import { createOrderSubmission, OrderSubmission, OrderItem } from '@/lib/orderSubmissionsApi';
import wooCommerceAPI, { WooCommerceProduct } from '@/lib/woocommerceApi';
import { supabase } from '@/integrations/supabase/client';
import { toast } from 'sonner';

interface RoleColors {
  gradient: string;
  hoverGradient: string;
  pulse: string;
  secondaryPulse: string;
  name: string;
  icon: any;
  bgColor: string;
  textColor: string;
}

interface Message {
  id: string;
  content: string;
  isUser: boolean;
  timestamp: Date;
  type?: 'text' | 'action' | 'order' | 'form' | 'product_search' | 'product_selection' | 'complaint_search' | 'quick_actions';
  actionData?: any;
  formData?: any;
  productData?: any;
}

interface OrderFormData {
  customerName: string;
  customerPhone: string;
  customerEmail: string;
  productId: number | null;
  productName: string;
  quantity: string;
  price: string;
  address: string;
  notes: string;
  currentStep: number;
}

const FloatingChatbot: React.FC = () => {
  const [isHovered, setIsHovered] = useState(false);
  const [isOpen, setIsOpen] = useState(false);
  const [isMinimized, setIsMinimized] = useState(false);
  const [messages, setMessages] = useState<Message[]>([]);
  const [inputValue, setInputValue] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const [pendingActions, setPendingActions] = useState<Set<string>>(new Set());
  const [orderForm, setOrderForm] = useState<OrderFormData>({
    customerName: '',
    customerPhone: '',
    customerEmail: '',
    productId: null,
    productName: '',
    quantity: '1',
    price: '',
    address: '',
    notes: '',
    currentStep: 0
  });
  const [isCreatingOrder, setIsCreatingOrder] = useState(false);
  const [isSearchingProducts, setIsSearchingProducts] = useState(false);
  const [searchResults, setSearchResults] = useState<WooCommerceProduct[]>([]);
  const [selectedProduct, setSelectedProduct] = useState<WooCommerceProduct | null>(null);
  const [isHandlingComplaint, setIsHandlingComplaint] = useState(false);
  const [showQuickActions, setShowQuickActions] = useState(false);
  const { user } = useAuth();
  const navigate = useNavigate();
  const location = useLocation();
  const messagesEndRef = useRef<HTMLDivElement>(null);

  // Hide chatbot on login screen
  if (location.pathname === '/login' || location.pathname === '/') {
    return null;
  }

  // Temporary: Chatbot disabled for v2.8.0 - Coming Soon
  return (
    <TooltipProvider>
      <div className="fixed bottom-4 right-4 z-50">
        <Tooltip>
          <TooltipTrigger asChild>
            <Button
              disabled
              className="h-14 w-14 rounded-full bg-gray-400 shadow-lg cursor-not-allowed opacity-50"
            >
              <MessageCircle className="h-6 w-6 text-white" />
            </Button>
          </TooltipTrigger>
          <TooltipContent side="left" className="max-w-xs">
            <div className="text-center">
              <p className="font-semibold">AI Assistant</p>
              <p className="text-sm text-muted-foreground">Coming Soon in v2.8.0</p>
              <p className="text-xs text-muted-foreground mt-1">Enhanced features in development</p>
            </div>
          </TooltipContent>
        </Tooltip>
      </div>
    </TooltipProvider>
  );

  // Role-based color configurations with enhanced functionality
  const getRoleColors = (): RoleColors => {
    if (user?.role === 'admin') {
      return {
        gradient: 'from-red-500 to-red-600',
        hoverGradient: 'hover:from-red-600 hover:to-red-700',
        pulse: 'bg-red-400',
        secondaryPulse: 'bg-red-300',
        name: 'Noorcare Admin Assistant',
        icon: Settings,
        bgColor: 'bg-red-500',
        textColor: 'text-red-600'
      };
    }

    switch (user?.position) {
      case 'Copy Writing':
        return {
          gradient: 'from-purple-500 to-purple-600',
          hoverGradient: 'hover:from-purple-600 hover:to-purple-700',
          pulse: 'bg-purple-400',
          secondaryPulse: 'bg-purple-300',
          name: 'Noorcare Creative Assistant',
          icon: Palette,
          bgColor: 'bg-purple-500',
          textColor: 'text-purple-600'
        };
      case 'Designer':
        return {
          gradient: 'from-green-500 to-green-600',
          hoverGradient: 'hover:from-green-600 hover:to-green-700',
          pulse: 'bg-green-400',
          secondaryPulse: 'bg-green-300',
          name: 'Noorcare Design Assistant',
          icon: FileText,
          bgColor: 'bg-green-500',
          textColor: 'text-green-600'
        };
      case 'Media Buyer':
        return {
          gradient: 'from-teal-700 to-teal-800',
          hoverGradient: 'hover:from-teal-800 hover:to-teal-900',
          pulse: 'bg-teal-600',
          secondaryPulse: 'bg-teal-500',
          name: 'Noorcare Campaign Assistant',
          icon: TrendingUp,
          bgColor: 'bg-teal-700',
          textColor: 'text-teal-700'
        };
      case 'Customer Service':
        return {
          gradient: 'from-sky-400 to-sky-500',
          hoverGradient: 'hover:from-sky-500 hover:to-sky-600',
          pulse: 'bg-sky-300',
          secondaryPulse: 'bg-sky-200',
          name: 'Noorcare Support Assistant',
          icon: Users,
          bgColor: 'bg-sky-400',
          textColor: 'text-sky-600'
        };
      default:
        return {
          gradient: 'from-blue-500 to-blue-600',
          hoverGradient: 'hover:from-blue-600 hover:to-blue-700',
          pulse: 'bg-blue-400',
          secondaryPulse: 'bg-blue-300',
          name: 'Noorcare AI Assistant',
          icon: Bot,
          bgColor: 'bg-blue-500',
          textColor: 'text-blue-600'
        };
    }
  };

  const roleColors = getRoleColors();

  // Scroll to bottom when new messages arrive
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  // Initialize with welcome message
  useEffect(() => {
    if (isOpen && messages.length === 0) {
      setTimeout(() => {
        const welcomeMessage: Message = {
          id: 'welcome',
          content: getWelcomeMessage(),
          isUser: false,
          timestamp: new Date(),
          type: 'text'
        };
        setMessages([welcomeMessage]);
      }, 500);
    }
  }, [isOpen, user?.position]);

  const getWelcomeMessage = (): string => {
    const greeting = `üëã Hello ${user?.name || 'there'}! I'm your ${roleColors.name}.`;
    
    switch (user?.position) {
      case 'Copy Writing':
        return `${greeting}\n\n‚ú® I can help you with:\n‚Ä¢ Creative copywriting\n‚Ä¢ Content creation\n‚Ä¢ Campaign ideas\n‚Ä¢ Brand messaging\n\nWhat would you like to work on today?`;
      case 'Designer':
        return `${greeting}\n\nüé® I can assist with:\n‚Ä¢ Design concepts\n‚Ä¢ Layout suggestions\n‚Ä¢ Color palettes\n‚Ä¢ Visual guidelines\n\nHow can I help with your design projects?`;
      case 'Media Buyer':
        return `${greeting}\n\nüìä I can help optimize:\n‚Ä¢ Campaign performance\n‚Ä¢ Budget allocation\n‚Ä¢ Audience targeting\n‚Ä¢ Analytics insights\n\nWhat campaigns are you working on?`;
      case 'Customer Service':
        return `${greeting}\n\nüõí I can help you:\n‚Ä¢ Create orders directly with WooCommerce integration\n‚Ä¢ Search and select products\n‚Ä¢ Handle customer inquiries\n‚Ä¢ Provide support tips\n\nHow can I assist you today?`;
      default:
        return `${greeting}\n\n‚öôÔ∏è I can help with:\n‚Ä¢ System management\n‚Ä¢ Analytics reports\n‚Ä¢ Team coordination\n‚Ä¢ Strategic insights\n\nWhat do you need assistance with?`;
    }
  };

  const getRoleSpecificActions = () => {
    switch (user?.position) {
      case 'Customer Service':
        return [
          { label: ' Create New Order', action: 'create_order', icon: ShoppingCart },
          { label: ' View Recent Orders', action: 'view_orders', icon: Package },
          { label: ' Customer Support Tips', action: 'support_tips', icon: Users },
          { label: ' Handle Complaints', action: 'complaint_help', icon: Phone }
        ];
      case 'Copy Writing':
        return [
          { label: '‚úçÔ∏è Write Product Copy', action: 'write_copy', icon: FileText },
          { label: 'üì± Social Media Content', action: 'social_content', icon: MessageCircle },
          { label: 'üí° Campaign Ideas', action: 'campaign_ideas', icon: Plus },
          { label: 'üéØ Content Strategy', action: 'content_strategy', icon: TrendingUp }
        ];
      case 'Designer':
        return [
          { label: 'üé® Color Palette Ideas', action: 'color_palette', icon: Palette },
          { label: 'üìê Layout Suggestions', action: 'layout_help', icon: FileText },
          { label: 'üñºÔ∏è Image Guidelines', action: 'image_guide', icon: Package },
          { label: '‚ú® Design Trends', action: 'design_trends', icon: TrendingUp }
        ];
      case 'Media Buyer':
        return [
          { label: 'üìä Campaign Analysis', action: 'campaign_analysis', icon: TrendingUp },
          { label: 'üí∞ Budget Optimization', action: 'budget_optimize', icon: CreditCard },
          { label: 'üéØ Audience Targeting', action: 'audience_target', icon: Users },
          { label: 'üìà Performance Metrics', action: 'performance_metrics', icon: Package }
        ];
      default:
        return [
          { label: 'üìä Generate Reports', action: 'generate_reports', icon: FileText },
          { label: 'üë• Team Management', action: 'team_management', icon: Users },
          { label: '‚öôÔ∏è System Settings', action: 'system_settings', icon: Settings },
          { label: 'üìà Analytics Dashboard', action: 'analytics', icon: TrendingUp }
        ];
    }
  };

  const createOrderSteps = [
    { field: 'customerName', label: 'Customer Name', icon: User, placeholder: 'Enter customer name...' },
    { field: 'customerPhone', label: 'Phone Number', icon: Phone, placeholder: 'Enter phone number...' },
    { field: 'customerEmail', label: 'Email Address', icon: MessageCircle, placeholder: 'Enter email address...' },
    { field: 'productSearch', label: 'Product Selection', icon: Search, placeholder: 'Search for product...' },
    { field: 'quantity', label: 'Quantity', icon: Plus, placeholder: 'Enter quantity...' },
    { field: 'address', label: 'Delivery Address', icon: MapPin, placeholder: 'Enter delivery address...' },
    { field: 'notes', label: 'Order Notes (Optional)', icon: FileText, placeholder: 'Any special notes...' }
  ];

  const searchProducts = async (query: string): Promise<WooCommerceProduct[]> => {
    try {
      setIsSearchingProducts(true);
      console.log('Searching products for:', query);
      
      const results = await wooCommerceAPI.fetchProducts({
        search: query,
        per_page: 10,
        status: 'publish',
        stock_status: 'instock'
      });
      
      console.log('Product search results:', results);
      return results;
    } catch (error) {
      console.error('Error searching products:', error);
      toast.error('Failed to search products');
      return [];
    } finally {
      setIsSearchingProducts(false);
    }
  };

  const handleOrderFormSubmit = async (value: string) => {
    const currentStep = createOrderSteps[orderForm.currentStep];
    
    // Handle product search step
    if (currentStep.field === 'productSearch') {
      if (!value.trim()) {
        const botMessage: Message = {
          id: Date.now().toString(),
          content: '‚ùå Please enter a product name to search.',
          isUser: false,
          timestamp: new Date(),
          type: 'text'
        };
        setMessages(prev => [...prev, botMessage]);
        return;
      }

      // Search for products
      const searchedProducts = await searchProducts(value);
      setSearchResults(searchedProducts);

      if (searchedProducts.length === 0) {
        const botMessage: Message = {
          id: Date.now().toString(),
          content: `‚ùå No products found for "${value}". Please try a different search term.`,
          isUser: false,
          timestamp: new Date(),
          type: 'text'
        };
        setMessages(prev => [...prev, botMessage]);
        return;
      }

      // Show product selection with images and buttons
      const botMessage: Message = {
        id: Date.now().toString(),
        content: `üõçÔ∏è Found ${searchedProducts.length} products. Choose one by clicking the button:`,
        isUser: false,
        timestamp: new Date(),
        type: 'product_selection',
        productData: { products: searchedProducts }
      };
      setMessages(prev => [...prev, botMessage]);
      return;
    }

    // Handle special commands for product selection
    if (messages[messages.length - 1]?.type === 'product_selection') {
      if (value.toLowerCase() === 'search again' || value.toLowerCase() === 'new search') {
        const botMessage: Message = {
          id: Date.now().toString(),
          content: 'üîç Please enter a new search term to find different products:',
          isUser: false,
          timestamp: new Date(),
          type: 'form',
          formData: { step: orderForm.currentStep, field: 'productSearch' }
        };
        setMessages(prev => [...prev, botMessage]);
        return;
      }
      
      // If no product was selected via button, show error
      const botMessage: Message = {
        id: Date.now().toString(),
        content: `‚ùå Please click one of the product buttons above to select a product, or type "search again" to search for different products.`,
        isUser: false,
        timestamp: new Date(),
        type: 'text'
      };
      setMessages(prev => [...prev, botMessage]);
      return;
    }

    // Handle regular form fields
    const newOrderForm = { ...orderForm, [currentStep.field]: value };
    
    if (orderForm.currentStep < createOrderSteps.length - 1) {
      // Move to next step
      newOrderForm.currentStep = orderForm.currentStep + 1;
      setOrderForm(newOrderForm);
      
      const nextStep = createOrderSteps[newOrderForm.currentStep];
      const botMessage: Message = {
        id: Date.now().toString(),
        content: `‚úÖ Got it! Now please provide the ${nextStep.label.toLowerCase()}:`,
        isUser: false,
        timestamp: new Date(),
        type: 'form',
        formData: { step: newOrderForm.currentStep, field: nextStep.field }
      };
      setMessages(prev => [...prev, botMessage]);
    } else {
      // Final step - create the actual order
      await createRealOrder(newOrderForm);
    }
  };

  const createRealOrder = async (orderData: OrderFormData) => {
    try {
      if (!selectedProduct || !user?.id) {
        throw new Error('Missing product or user information');
      }

      const [firstName, ...lastNameParts] = orderData.customerName.split(' ');
      const lastName = lastNameParts.join(' ') || '';

      // Create order submission data
      const orderSubmissionData: OrderSubmission = {
        customer_first_name: firstName,
        customer_last_name: lastName,
        customer_phone: orderData.customerPhone,
        customer_email: orderData.customerEmail || '',
        billing_address_1: orderData.address,
        billing_city: 'Riyadh', // Default city
        billing_country: 'Saudi Arabia',
        order_items: [{
          product_id: selectedProduct.id,
          product_name: selectedProduct.name,
          quantity: parseInt(orderData.quantity),
          price: selectedProduct.sale_price || selectedProduct.price,
          sku: selectedProduct.sku || ''
        }] as OrderItem[],
        subtotal: parseFloat(selectedProduct.sale_price || selectedProduct.price) * parseInt(orderData.quantity),
        total_amount: parseFloat(selectedProduct.sale_price || selectedProduct.price) * parseInt(orderData.quantity),
        customer_note: orderData.notes,
        status: 'processing',
        payment_method: 'cod',
        payment_status: 'pending'
      };

      // Save to database
      const savedOrder = await createOrderSubmission(orderSubmissionData, user.id, user.name);
      
      // Create WooCommerce order
      const wooOrderData = {
        payment_method: 'cod',
        payment_method_title: 'Cash on Delivery',
        set_paid: false,
        status: 'processing',
        billing: {
          first_name: firstName,
          last_name: lastName,
          company: '',
          address_1: orderData.address,
          address_2: '',
          city: 'Riyadh',
          state: '',
          postcode: '',
          country: 'SA',
          email: orderData.customerEmail || '',
          phone: orderData.customerPhone
        },
        shipping: {
          first_name: firstName,
          last_name: lastName,
          company: '',
          address_1: orderData.address,
          address_2: '',
          city: 'Riyadh',
          state: '',
          postcode: '',
          country: 'SA',
          phone: orderData.customerPhone
        },
        line_items: [{
          product_id: selectedProduct.id,
          quantity: parseInt(orderData.quantity)
        }],
        customer_note: orderData.notes || '',
        meta_data: [
          {
            key: '_created_by_customer_service',
            value: user?.name || 'Customer Service'
          },
          {
            key: '_internal_order_id',
            value: savedOrder.id?.toString() || ''
          },
          {
            key: '_created_via_chatbot',
            value: 'true'
          }
        ]
      };

      // Create order in WooCommerce
      const createdOrder = await wooCommerceAPI.createOrder(wooOrderData);
      
             // Update our database record with WooCommerce info
       if (savedOrder.id && createdOrder.number) {
         await supabase
           .from('order_submissions')
           .update({ 
             order_number: `#${createdOrder.number}`,
             woocommerce_order_id: createdOrder.id,
             is_synced_to_woocommerce: true
           })
           .eq('id', savedOrder.id);
       }

      const orderSummary = `üéâ Order Created Successfully!\n\nüì¶ Order #${createdOrder.number}\n\nüìã Summary:\n‚Ä¢ Customer: ${orderData.customerName}\n‚Ä¢ Phone: ${orderData.customerPhone}\n‚Ä¢ Product: ${selectedProduct.name}\n‚Ä¢ Quantity: ${orderData.quantity}\n‚Ä¢ Price: ${selectedProduct.sale_price || selectedProduct.price} SAR each\n‚Ä¢ Total: ${parseFloat(selectedProduct.sale_price || selectedProduct.price) * parseInt(orderData.quantity)} SAR\n‚Ä¢ Address: ${orderData.address}\n‚Ä¢ Notes: ${orderData.notes || 'None'}\n\n‚úÖ Order saved to database and created in WooCommerce!`;
      
      const successMessage: Message = {
        id: Date.now().toString(),
        content: orderSummary,
        isUser: false,
        timestamp: new Date(),
        type: 'text'
      };
      
      setMessages(prev => [...prev, successMessage]);
      setIsCreatingOrder(false);
      setSelectedProduct(null);
      setSearchResults([]);
      
      // Reset form for next order
      setOrderForm({
        customerName: '',
        customerPhone: '',
        customerEmail: '',
        productId: null,
        productName: '',
        quantity: '1',
        price: '',
        address: '',
        notes: '',
        currentStep: 0
      });
      
      // Reset pending actions
      setPendingActions(new Set());
      
      toast.success(`Order #${createdOrder.number} created successfully!`);
      
    } catch (error: any) {
      console.error('Error creating order:', error);
      const errorMessage: Message = {
        id: Date.now().toString(),
        content: `‚ùå Failed to create order: ${error.message}. Please try again or contact support.`,
        isUser: false,
        timestamp: new Date(),
        type: 'text'
      };
      setMessages(prev => [...prev, errorMessage]);
      toast.error('Failed to create order');
    }
  };

  const handleRoleAction = async (action: string) => {
    // Check if action is already pending
    if (pendingActions.has(action)) {
      const duplicateMessage: Message = {
        id: Date.now().toString(),
        content: '‚è≥ I\'m already processing this request. Please wait for it to complete before requesting again.',
        isUser: false,
        timestamp: new Date(),
        type: 'text'
      };
      setMessages(prev => [...prev, duplicateMessage]);
      return;
    }

    // Add action to pending set
    setPendingActions(prev => new Set(prev).add(action));

    // Add user message for the action
    const actionLabel = getRoleSpecificActions().find(a => a.action === action)?.label;
    const userMessage: Message = {
      id: Date.now().toString(),
      content: `Requested: ${actionLabel}`,
      isUser: true,
      timestamp: new Date(),
      type: 'action'
    };
    setMessages(prev => [...prev, userMessage]);
    setIsTyping(true);

    // Handle specific actions
    setTimeout(async () => {
      let botResponse: Message;

      switch (action) {
        case 'create_order':
          setIsCreatingOrder(true);
          setOrderForm(prev => ({ ...prev, currentStep: 0 }));
          botResponse = {
            id: (Date.now() + 1).toString(),
            content: 'üõí Let\'s create a new order with real WooCommerce integration!\n\nI\'ll guide you through each step and search for actual products.\n\nFirst, please provide the customer name:',
            isUser: false,
            timestamp: new Date(),
            type: 'form',
            formData: { step: 0, field: 'customerName' }
          };
          break;

        case 'view_orders':
          botResponse = {
            id: (Date.now() + 1).toString(),
            content: 'üìã Opening your orders page to view recent orders...',
            isUser: false,
            timestamp: new Date(),
            type: 'action'
          };
          setTimeout(() => {
            navigate('/my-orders');
            setIsOpen(false);
          }, 1500);
          break;

        case 'support_tips':
          botResponse = {
            id: (Date.now() + 1).toString(),
            content: 'üí° Customer Support Best Practices:\n\n1. üëÇ Listen actively to understand concerns\n2. ü§ù Acknowledge their frustration first\n3. üìù Provide clear, step-by-step solutions\n4. üìû Follow up to ensure satisfaction\n5. üìã Document important interactions\n6. üòä Stay positive and professional\n\nNeed help with a specific situation?',
            isUser: false,
            timestamp: new Date(),
            type: 'text'
          };
          break;

        case 'complaint_help':
          setIsHandlingComplaint(true);
          botResponse = {
            id: (Date.now() + 1).toString(),
            content: `üìû Customer Complaint Handling Guide | ÿØŸÑŸäŸÑ ÿßŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿ¥ŸÉÿßŸàŸâ ÿßŸÑÿπŸÖŸÑÿßÿ°

üá¨üáß **English Guidelines:**
1. üëÇ Listen actively without interrupting
2. ü§ù Acknowledge: "I understand your frustration"
3. üîç Ask clarifying questions to understand fully
4. üí° Offer 2-3 solution options when possible
5. ‚è∞ Set clear expectations for resolution time
6. üìû Follow up within 24-48 hours
7. üìã Document everything in customer notes

üá∏üá¶ **ÿßŸÑÿ•ÿ±ÿ¥ÿßÿØÿßÿ™ ÿ®ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ©:**
1. üëÇ ÿßÿ≥ÿ™ŸÖÿπ ÿ®ŸÅÿπÿßŸÑŸäÿ© ÿØŸàŸÜ ŸÖŸÇÿßÿ∑ÿπÿ©
2. ü§ù ÿßÿπÿ™ÿ±ŸÅ ÿ®ŸÖÿ¥ÿßÿπÿ±ŸáŸÖ: "ÿ£ŸÅŸáŸÖ ÿßŸÜÿ≤ÿπÿßÿ¨ŸÉ"
3. üîç ÿßÿ∑ÿ±ÿ≠ ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ™Ÿàÿ∂Ÿäÿ≠Ÿäÿ© ŸÑŸÑŸÅŸáŸÖ ÿßŸÑŸÉÿßŸÖŸÑ
4. üí° ÿßŸÇÿ™ÿ±ÿ≠ 2-3 ÿÆŸäÿßÿ±ÿßÿ™ ŸÑŸÑÿ≠ŸÑ ÿπŸÜÿØ ÿßŸÑÿ•ŸÖŸÉÿßŸÜ
5. ‚è∞ ÿ≠ÿØÿØ ÿ™ŸàŸÇÿπÿßÿ™ Ÿàÿßÿ∂ÿ≠ÿ© ŸÑŸàŸÇÿ™ ÿßŸÑÿ≠ŸÑ
6. üìû ÿ™ÿßÿ®ÿπ ÿÆŸÑÿßŸÑ 24-48 ÿ≥ÿßÿπÿ©
7. üìã Ÿàÿ´ŸÇ ŸÉŸÑ ÿ¥Ÿäÿ° ŸÅŸä ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿßŸÑÿπŸÖŸäŸÑ

üéØ **Quick Response Templates:**

**English:**
‚Ä¢ "Thank you for bringing this to our attention"
‚Ä¢ "I sincerely apologize for the inconvenience"
‚Ä¢ "Let me look into this immediately"
‚Ä¢ "Here's what I can do to resolve this"

**Arabic:**
‚Ä¢ "ÿ¥ŸÉÿ±ÿßŸã ŸÑŸÉ ÿπŸÑŸâ ŸÑŸÅÿ™ ÿßŸÜÿ™ÿ®ÿßŸáŸÜÿß ŸÑŸáÿ∞ÿß ÿßŸÑÿ£ŸÖÿ±"
‚Ä¢ "ÿ£ÿπÿ™ÿ∞ÿ± ÿ®ÿµÿØŸÇ ÿπŸÜ ÿßŸÑÿ•ÿ≤ÿπÿßÿ¨"
‚Ä¢ "ÿØÿπŸÜŸä ÿ£ÿ®ÿ≠ÿ´ ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑÿ£ŸÖÿ± ŸÅŸàÿ±ÿßŸã"
‚Ä¢ "ÿ•ŸÑŸäŸÉ ŸÖÿß ŸäŸÖŸÉŸÜŸÜŸä ŸÅÿπŸÑŸá ŸÑÿ≠ŸÑ Ÿáÿ∞ÿß"

üîç **Interactive Help:**
Now you can ask me any specific question about customer complaints, product issues, or any topic and I'll search Google for the most current information to help you provide accurate answers to customers.

Type your question below (in English or Arabic):`,
            isUser: false,
            timestamp: new Date(),
            type: 'complaint_search'
          };
          break;

        case 'write_copy':
          botResponse = {
            id: (Date.now() + 1).toString(),
            content: '‚úçÔ∏è Copywriting Success Framework:\n\n1. üéØ Know your target audience\n2. üí° Lead with benefits, not features\n3. ‚ù§Ô∏è Use emotional triggers\n4. ‚≠ê Include social proof\n5. üìû End with a clear call-to-action\n6. üîÑ Test and optimize\n\nWhat product or service are you writing copy for?',
            isUser: false,
            timestamp: new Date(),
            type: 'text'
          };
          break;

        case 'campaign_analysis':
          botResponse = {
            id: (Date.now() + 1).toString(),
            content: 'üìä Campaign Analysis Checklist:\n\n‚Ä¢ üëÜ CTR (Click-Through Rate)\n‚Ä¢ üí∞ CPC (Cost Per Click)\n‚Ä¢ üìà ROAS (Return on Ad Spend)\n‚Ä¢ üéØ Conversion Rate\n‚Ä¢ üë• Audience Demographics\n‚Ä¢ üì± Device Performance\n‚Ä¢ ‚è∞ Time-based Performance\n\nOpening analytics dashboard...',
            isUser: false,
            timestamp: new Date(),
            type: 'action'
          };
          setTimeout(() => {
            navigate('/analytics');
            setIsOpen(false);
          }, 1500);
          break;

        default:
          botResponse = {
            id: (Date.now() + 1).toString(),
            content: '‚ú® I\'m here to help! What specific assistance do you need with your tasks?',
            isUser: false,
            timestamp: new Date(),
            type: 'text'
          };
      }

      setMessages(prev => [...prev, botResponse]);
      setIsTyping(false);
      
      // Remove action from pending set if not creating order
      if (action !== 'create_order') {
        setPendingActions(prev => {
          const newSet = new Set(prev);
          newSet.delete(action);
          return newSet;
        });
      }
    }, 1000 + Math.random() * 1000);
  };

  const handleProductSelection = (product: WooCommerceProduct) => {
    setSelectedProduct(product);
    
    const newOrderForm = { 
      ...orderForm, 
      productId: product.id,
      productName: product.name,
      price: product.sale_price || product.price,
      currentStep: orderForm.currentStep + 1
    };
    setOrderForm(newOrderForm);

    const nextStep = createOrderSteps[newOrderForm.currentStep];
    const botMessage: Message = {
      id: Date.now().toString(),
      content: `‚úÖ Selected: ${product.name} (${product.sale_price || product.price} SAR)\n\nNow please provide the ${nextStep.label.toLowerCase()}:`,
      isUser: false,
      timestamp: new Date(),
      type: 'form',
      formData: { step: newOrderForm.currentStep, field: nextStep.field }
    };
    setMessages(prev => [...prev, botMessage]);
  };

  const performWebSearch = async (query: string): Promise<any> => {
    // In a real implementation, this would call a web search API
    // For now, we'll simulate the search functionality
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve({
          results: [
            {
              title: "Customer Service Best Practices",
              snippet: "When dealing with angry customers, always listen actively, acknowledge their feelings, and provide clear solutions. Stay calm and professional."
            }
          ]
        });
      }, 1000);
    });
  };

  const formatWebSearchResponse = (originalQuery: string, searchResults: any): string => {
    // Check if query is in Arabic
    const isArabicQuery = /[\u0600-\u06FF]/.test(originalQuery);
    
    if (isArabicQuery) {
      return `üîç **ÿØŸÑŸäŸÑ ÿ¥ÿßŸÖŸÑ ŸÑŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿßŸÑÿπŸÖŸÑÿßÿ° ÿ∫Ÿäÿ± ÿßŸÑÿ±ÿßÿ∂ŸäŸÜ - "${originalQuery}"**

üìã **ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ¥ÿßÿ¶ÿπÿ© ŸÖŸÜ ÿßŸÑÿπŸÖŸÑÿßÿ° ÿ∫Ÿäÿ± ÿßŸÑÿ±ÿßÿ∂ŸäŸÜ (ŸÖÿπ ŸÜŸÖÿßÿ∞ÿ¨ ÿ±ÿØŸàÿØ ŸÖÿ≠ÿ™ÿ±ŸÅÿ©)**

**1Ô∏è‚É£ "ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÑŸÖ ŸäÿµŸÑ ÿ®ÿπÿØÿå Ÿàÿ£ŸÜÿß ÿ∫Ÿäÿ± ÿ±ÿßÿ∂Ÿç ÿπŸÜ ÿßŸÑÿ™ÿ£ÿÆŸäÿ±!"**
üí¨ **ÿßŸÑÿ±ÿØ ÿßŸÑŸÖÿ´ÿßŸÑŸä:**
"ŸÜÿπÿ™ÿ∞ÿ± ÿ®ÿµÿØŸÇ ÿπŸÜ ÿßŸÑÿ™ÿ£ÿÆŸäÿ±. ŸÜÿ™ŸÅŸáŸÖ ÿ£ŸáŸÖŸäÿ© ŸàÿµŸàŸÑ ÿ∑ŸÑÿ®ŸÉ ŸÅŸä ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ≠ÿØÿØ. ÿ≥ŸÜÿ™ÿ≠ŸÇŸÇ ŸÖÿπ ŸÅÿ±ŸäŸÇ ÿßŸÑÿ¥ÿ≠ŸÜ ŸÅŸàÿ±Ÿãÿß ŸàŸÜÿ±ÿ≥ŸÑ ŸÑŸÉ ÿ™ÿ≠ÿØŸäÿ´Ÿãÿß ÿÆŸÑÿßŸÑ ÿ≥ÿßÿπÿ©. ŸÉÿ™ÿπŸàŸäÿ∂ÿå ŸÜŸÇÿØŸÖ ŸÑŸÉ ÿÆÿµŸÖ 15% ÿπŸÑŸâ ÿ∑ŸÑÿ®ŸÉ ÿßŸÑŸÇÿßÿØŸÖ."

**2Ô∏è‚É£ "ÿßŸÑŸÖŸÉŸÖŸÑ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿä ŸÑŸÖ Ÿäÿπÿ∑Ÿê ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÖÿ™ŸàŸÇÿπÿ©!"**
üí¨ **ÿßŸÑÿ±ÿØ ÿßŸÑŸÖÿ´ÿßŸÑŸä:**
"ŸÜŸÇÿØÿ± ŸÖŸÑÿßÿ≠ÿ∏ÿ™ŸÉ ÿßŸÑÿµÿßÿØŸÇÿ©. ŸÜŸàÿµŸä ÿ®ÿßÿ≥ÿ™ÿ¥ÿßÿ±ÿ© ÿ£ÿÆÿµÿßÿ¶Ÿä ÿ™ÿ∫ÿ∞Ÿäÿ© ŸÑÿ∂ŸÖÿßŸÜ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿßŸÑŸÖŸÜÿßÿ≥ÿ® ŸÑÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ŸÉ. ŸÜŸÇÿØŸÖ ŸÑŸÉ ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑŸãÿß ÿ®ŸÖŸÜÿ™ÿ¨ ÿ¢ÿÆÿ± ÿ£Ÿà ÿßÿ≥ÿ™ÿ±ÿØÿßÿØŸãÿß ŸÉÿßŸÖŸÑŸãÿßÿå ŸàŸÜÿ≥ÿπÿØ ÿ®ÿ•ÿ±ÿ≥ÿßŸÑ ÿØŸÑŸäŸÑ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÖŸÅÿµŸÑ ŸÖÿ¨ÿßŸÜŸãÿß."

**3Ô∏è‚É£ "ÿßŸÑÿ™ÿ∫ŸÑŸäŸÅ ŸÉÿßŸÜ ÿ™ÿßŸÑŸÅŸãÿß ÿπŸÜÿØ ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ!"**
üí¨ **ÿßŸÑÿ±ÿØ ÿßŸÑŸÖÿ´ÿßŸÑŸä:**
"ŸÜÿ£ÿ≥ŸÅ ŸÑŸáÿ∞Ÿá ÿßŸÑÿ™ÿ¨ÿ±ÿ®ÿ©. ÿ≥ŸÑÿßŸÖÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ£ŸàŸÑŸàŸäÿ™ŸÜÿß. ÿ≥ŸÜŸÇŸàŸÖ ÿ®ÿ•ÿ±ÿ≥ÿßŸÑ ÿ®ÿØŸäŸÑ ŸÅŸàÿ±Ÿä ÿØŸàŸÜ ÿ™ŸÉŸÑŸÅÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©ÿå Ÿàÿ≥ŸÜÿ™ÿßÿ®ÿπ ŸÖÿπ ÿ¥ÿ±ŸÉÿ© ÿßŸÑÿ¥ÿ≠ŸÜ ŸÑÿ∂ŸÖÿßŸÜ ÿπÿØŸÖ ÿ™ŸÉÿ±ÿßÿ± Ÿáÿ∞ÿß ÿßŸÑÿ£ŸÖÿ±."

**4Ô∏è‚É£ "ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÖÿÆÿ™ŸÑŸÅ ÿπŸÜ ÿßŸÑŸàÿµŸÅ ÿπŸÑŸâ ÿßŸÑŸÖŸàŸÇÿπ!"**
üí¨ **ÿßŸÑÿ±ÿØ ÿßŸÑŸÖÿ´ÿßŸÑŸä:**
"ÿ¥ŸÉÿ±Ÿãÿß ŸÑÿ•ÿπŸÑÿßŸÖŸÜÿß ÿ®Ÿáÿ∞ÿß. ÿ≥ŸÜÿ±ÿßÿ¨ÿπ ÿßŸÑŸàÿµŸÅ ŸÅŸàÿ±Ÿãÿß ŸÑÿ™ÿ¨ŸÜÿ® ÿ£Ÿä ŸÑÿ®ÿ≥. ŸäŸÖŸÉŸÜŸÉ ÿ•ŸÖÿß ÿßŸÑÿßÿ≠ÿ™ŸÅÿßÿ∏ ÿ®ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÖÿπ ÿÆÿµŸÖ 20% ÿ£Ÿà ÿ•ÿπÿßÿØÿ™Ÿá ŸÖÿπ ÿ™ÿ∫ÿ∑Ÿäÿ© ŸÉÿßŸÖŸÑÿ© ŸÑŸÑÿ™ŸÉÿßŸÑŸäŸÅ."

**5Ô∏è‚É£ "Ÿàÿßÿ¨Ÿáÿ™ ŸÖÿ¥ŸÉŸÑÿ© ŸÅŸÜŸäÿ© ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿØŸÅÿπ ŸàŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ∑ŸÑÿ®!"**
üí¨ **ÿßŸÑÿ±ÿØ ÿßŸÑŸÖÿ´ÿßŸÑŸä:**
"ŸÜÿπÿ™ÿ∞ÿ± ÿπŸÜ ÿßŸÑÿ•ÿ≤ÿπÿßÿ¨. ÿ≥ŸÜÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÜÿ∏ÿßŸÖ ŸÅŸàÿ±Ÿãÿß. ŸäŸèÿ±ÿ¨Ÿâ ÿ•ÿ±ÿ≥ÿßŸÑ ŸÑŸÇÿ∑ÿ© ÿ¥ÿßÿ¥ÿ© ŸÑŸÑÿÆÿ∑ÿ£ ÿ•ŸÜ ÿ£ŸÖŸÉŸÜÿå Ÿàÿ≥ŸÜÿ∂ŸÖŸÜ ÿ≠ÿµŸàŸÑŸÉ ÿπŸÑŸâ ÿÆÿµŸÖ 10% ŸÑÿ™ÿπŸàŸäÿ∂ ŸàŸÇÿ™ŸÉ."

üõ†Ô∏è **ÿßÿ≥ÿ™ÿ±ÿßÿ™Ÿäÿ¨Ÿäÿßÿ™ ÿßŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿßŸÑÿ≥ÿÆÿ∑ (ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ŸÖÿ±ÿßÿ≠ŸÑ ÿßŸÑÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ¥ÿ±ÿßÿ¶Ÿäÿ©)**

**üéØ ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ ÿßŸÑŸÅÿπŸëÿßŸÑ:**
ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿπÿ®ÿßÿ±ÿßÿ™ ŸÖÿ´ŸÑ: "ÿ£ÿ™ŸÅŸáŸÖ ÿ•ÿ≠ÿ®ÿßÿ∑ŸÉ ÿ™ŸÖÿßŸÖŸãÿß..." ÿ´ŸÖ ŸÉÿ±ÿ± ŸÖÿ¥ŸÉŸÑÿ™ŸáŸÖ ÿ®ŸÑÿ∫ÿ™ŸÉ ŸÑÿ™ÿ£ŸÉŸäÿØ ÿßŸÑŸÅŸáŸÖ.

**üôè ÿßŸÑÿßÿπÿ™ÿ∞ÿßÿ± ÿØŸàŸÜ ÿ™ÿ®ÿ±Ÿäÿ±:**
ÿ™ÿ¨ŸÜÿ®: "ÿßŸÑÿ™ÿ£ÿÆŸäÿ± ÿ®ÿ≥ÿ®ÿ® ÿßŸÑÿπÿ∑ŸÑ ÿßŸÑŸÅŸÜŸä..."ÿå Ÿàÿßÿ≥ÿ™ÿ®ÿØŸÑŸáÿß ÿ®ŸÄ: "ŸÜÿ™ÿ≠ŸÖŸÑ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäÿ© ÿßŸÑŸÉÿßŸÖŸÑÿ© ŸàŸÜÿπÿ™ÿ∞ÿ± ÿ®ÿµÿØŸÇ".

**‚ö° ÿßŸÑÿ≠ŸÑŸàŸÑ ÿßŸÑÿ≥ÿ±Ÿäÿπÿ© ŸàÿßŸÑŸÖŸÑŸÖŸàÿ≥ÿ©:**
ŸÇÿØŸÖ ÿÆŸäÿßÿ±ŸäŸÜ ÿØÿßÿ¶ŸÖŸãÿß (ŸÖÿ´ŸÑ: ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ/ÿßÿ≥ÿ™ÿ±ÿØÿßÿØÿå ÿÆÿµŸÖ/ŸáÿØŸäÿ© ŸÖÿ¨ÿßŸÜŸäÿ©).

**üìû ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ© ÿ®ÿπÿØ ÿßŸÑÿ≠ŸÑ:**
ÿ£ÿ±ÿ≥ŸÑ ÿ±ÿ≥ÿßŸÑÿ© ÿ®ÿπÿØ 3 ÿ£ŸäÿßŸÖ: "ŸáŸÑ ÿ≠ŸèŸÑÿ™ ŸÖÿ¥ŸÉŸÑÿ™ŸÉ ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ™ÿ±ÿ∂ŸäŸÉÿü ŸÜŸÇÿØÿ± ÿ±ÿ£ŸäŸÉ ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ÿÆÿØŸÖÿßÿ™ŸÜÿß."

üìä **ŸÜŸÖŸàÿ∞ÿ¨ ÿ™ÿµÿπŸäÿØ ÿßŸÑÿ¥ŸÉÿßŸàŸâ (ŸÑŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿØÿßÿÆŸÑŸä)**

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ **ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ≥ÿÆÿ∑**         ‚îÇ **ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°**                      ‚îÇ **ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ**         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üü¢ ŸÖŸÜÿÆŸÅÿ∂                ‚îÇ ÿÆÿµŸÖ 10% + ŸÖÿ™ÿßÿ®ÿπÿ© ÿßŸÑÿ¥ÿ≠ŸÜ           ‚îÇ ŸÖŸÖÿ´ŸÑ ÿÆÿØŸÖÿ© ÿßŸÑÿπŸÖŸÑÿßÿ°   ‚îÇ
‚îÇ (ÿ™ÿ£ÿÆŸäÿ± ÿ®ÿ≥Ÿäÿ∑)            ‚îÇ                                  ‚îÇ                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üü° ŸÖÿ™Ÿàÿ≥ÿ∑                ‚îÇ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ®ÿØŸäŸÑ ŸÅŸàÿ±Ÿä +               ‚îÇ ÿßŸÑŸÖÿ¥ÿ±ŸÅ              ‚îÇ
‚îÇ (ŸÖŸÜÿ™ÿ¨ ÿ™ÿßŸÑŸÅ)             ‚îÇ ÿ±ÿ≥ÿßŸÑÿ© ÿßÿπÿ™ÿ∞ÿßÿ±                    ‚îÇ                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üî¥ ÿπÿßŸÑŸä                 ‚îÇ ÿßÿ™ÿµÿßŸÑ Ÿáÿßÿ™ŸÅŸä +                   ‚îÇ ŸÖÿØŸäÿ± ÿßŸÑÿÆÿØŸÖÿ©        ‚îÇ
‚îÇ (ŸÖÿ¥ŸÉŸÑÿ© ŸÖÿ™ŸÉÿ±ÿ±ÿ©)          ‚îÇ ÿ™ÿπŸàŸäÿ∂ ÿ®ŸÇŸäŸÖÿ© 30%                 ‚îÇ                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

**üìã ÿ•ÿ±ÿ¥ÿßÿØÿßÿ™ ÿ≥ÿ±Ÿäÿπÿ© ŸÑŸÑÿ™ÿ∑ÿ®ŸäŸÇ:**
‚Ä¢ üü¢ **ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑŸÖŸÜÿÆŸÅÿ∂:** ÿ™ÿπÿßŸÖŸÑ ŸÖÿ®ÿßÿ¥ÿ± ŸÖŸÜ ÿßŸÑŸÖŸÖÿ´ŸÑ
‚Ä¢ üü° **ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑:** ÿ•ÿ¥ÿ±ÿßŸÉ ÿßŸÑŸÖÿ¥ÿ±ŸÅ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±
‚Ä¢ üî¥ **ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿπÿßŸÑŸä:** ÿ™ÿØÿÆŸÑ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿÆÿØŸÖÿ© ŸÅŸàÿ±ÿßŸã

üí° **ŸÜÿµÿßÿ¶ÿ≠ ÿÆÿßÿµÿ© ÿ®ŸÖÿ™ÿßÿ¨ÿ± ÿßŸÑŸÖŸÉŸÖŸÑÿßÿ™ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ©**
‚Ä¢ **ÿßŸÑÿ¥ŸÅÿßŸÅŸäÿ© ÿßŸÑÿ∑ÿ®Ÿäÿ©:** ÿ∞ŸÉŸëÿ± ÿßŸÑÿπŸÖŸÑÿßÿ° ÿ®ÿ£ŸÜ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿ™ÿÆÿ™ŸÑŸÅ ÿ≠ÿ≥ÿ® ÿßŸÑÿ¨ÿ≥ŸÖÿå ŸàŸÜŸàŸëŸá ÿ®ÿ∂ÿ±Ÿàÿ±ÿ© ÿßÿ≥ÿ™ÿ¥ÿßÿ±ÿ© ÿßŸÑÿ∑ÿ®Ÿäÿ® ŸÇÿ®ŸÑ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ
‚Ä¢ **ÿ™Ÿàÿ´ŸäŸÇ ÿßŸÑÿ¥ŸÉÿßŸàŸâ:** ÿ£ŸÜÿ¥ÿ¶ ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸÑŸÖÿ¥ŸÉŸÑÿßÿ™ ÿßŸÑŸÖÿ™ŸÉÿ±ÿ±ÿ© (ŸÖÿ´ŸÑ: ÿ™ÿ∫ŸÑŸäŸÅ Ÿáÿ¥ÿå ÿ™ÿ£ÿÆŸäÿ± ÿ¥ÿ≠ŸÜ) ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™
‚Ä¢ **ÿßŸÑÿ™ÿØÿ±Ÿäÿ®:** ÿØÿ±Ÿëÿ® ŸÅÿ±ŸäŸÇŸÉ ÿπŸÑŸâ ÿßŸÑŸÖÿµÿ∑ŸÑÿ≠ÿßÿ™ ÿßŸÑÿ∑ÿ®Ÿäÿ© ÿßŸÑÿ®ÿ≥Ÿäÿ∑ÿ© ŸÑÿ™Ÿàÿ∂Ÿäÿ≠ ŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ®ÿØŸÇÿ©

üìå **ŸÖÿ´ÿßŸÑ ÿ™ÿ∑ÿ®ŸäŸÇŸä ŸÑÿ≥ŸäŸÜÿßÿ±ŸäŸà ŸÖÿπŸÇÿØ**
**ÿßŸÑÿπŸÖŸäŸÑ:** "ÿ∑ŸÑÿ®ÿ™ 3 ÿπÿ®Ÿàÿßÿ™ ŸàŸÑŸÖ ÿ™ÿµŸÑÿå Ÿàÿ£ÿ±ŸäÿØ ÿßÿ≥ÿ™ÿ±ÿØÿßÿØ ÿ£ŸÖŸàÿßŸÑŸä ÿßŸÑÿ¢ŸÜ!"
**ÿßŸÑÿ±ÿØ:**
"ŸÜÿπÿ™ÿ∞ÿ± ÿ®ÿ¥ÿØÿ© ÿπŸÜ Ÿáÿ∞ÿß ÿßŸÑÿÆŸÑŸÑ ÿ∫Ÿäÿ± ÿßŸÑŸÖŸÇÿ®ŸàŸÑ. ÿ≥ŸÜŸÇŸàŸÖ ÿ®ŸÄ:
‚Ä¢ ÿßÿ≥ÿ™ÿ±ÿØÿßÿØ ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿÆŸÑÿßŸÑ 24 ÿ≥ÿßÿπÿ©
‚Ä¢ ÿ•ÿ±ÿ≥ÿßŸÑ ŸáÿØŸäÿ© (ÿπŸäŸÜÿ© ŸÖŸÜ ŸÖŸÜÿ™ÿ¨ ÿ¨ÿØŸäÿØ) ŸÉÿßÿπÿ™ÿ∞ÿßÿ±
‚Ä¢ ÿßŸÑÿ™ÿ≠ŸÇŸäŸÇ ŸÖÿπ ŸÖÿ≤ŸàÿØ ÿßŸÑÿ¥ÿ≠ŸÜ ŸÑŸÖÿπÿ±ŸÅÿ© ÿßŸÑÿ≥ÿ®ÿ® Ÿàÿ•ÿπŸÑÿßŸÖŸÉ ÿ®ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨"

üîÑ **ÿßŸÉÿ™ÿ® "ÿ®ÿ≠ÿ´ ÿ¨ÿØŸäÿØ" ŸÑŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖŸàÿ∂Ÿàÿπ ÿ¢ÿÆÿ± ÿ£Ÿà "ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ®ÿ≠ÿ´" ŸÑŸÑÿπŸàÿØÿ© ŸÑŸÑÿØÿ±ÿØÿ¥ÿ© ÿßŸÑÿπÿßÿØŸäÿ©**`;
    }
    
    return `üîç **Comprehensive Customer Complaint Resolution Guide - "${originalQuery}"**

üìã **Common Upset Customer Scenarios (with Professional Response Templates)**

**1Ô∏è‚É£ "My order hasn't arrived yet, and I'm really frustrated with the delay!"**
üí¨ **Ideal Response:**
"I sincerely apologize for the delay. I understand how important it is to receive your order on time. I'll check with our shipping team immediately and send you an update within the hour. As compensation, I'd like to offer you a 15% discount on your next order."

**2Ô∏è‚É£ "The supplement didn't give me the expected results!"**
üí¨ **Ideal Response:**
"I appreciate your honest feedback. I recommend consulting with a nutritionist to ensure you're using the right product for your needs. We can offer you either an exchange for a different product or a full refund, plus I'd be happy to send you a detailed usage guide for free."

**3Ô∏è‚É£ "The packaging was damaged when I received it!"**
üí¨ **Ideal Response:**
"I'm sorry for this experience. Product safety is our top priority. We'll send you an immediate replacement at no additional cost, and I'll follow up with our shipping partner to ensure this doesn't happen again."

**4Ô∏è‚É£ "The product is different from what was described on the website!"**
üí¨ **Ideal Response:**
"Thank you for bringing this to our attention. We'll review the description immediately to avoid any confusion. You can either keep the product with a 20% discount or return it with full cost coverage."

**5Ô∏è‚É£ "I had a technical issue during payment and my order wasn't confirmed!"**
üí¨ **Ideal Response:**
"I apologize for the inconvenience. I'll check our system immediately. If possible, please send a screenshot of the error, and I'll ensure you receive a 10% discount to compensate for your time."

üõ†Ô∏è **De-escalation Strategies (Based on Customer Journey Stages)**

**üéØ Active Listening:**
Use phrases like: "I completely understand your frustration..." then repeat their issue in your own words to confirm understanding.

**üôè Apologize Without Excuses:**
Avoid: "The delay was due to technical issues..." Replace with: "We take full responsibility and sincerely apologize."

**‚ö° Quick & Tangible Solutions:**
Always offer two options (like: replacement/refund, discount/free gift).

**üìû Post-Resolution Follow-up:**
Send a message after 3 days: "Has your issue been resolved to your satisfaction? We value your feedback to improve our services."

üìä **Complaint Escalation Matrix (Internal Team)**

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ **Frustration Level**   ‚îÇ **Action Required**              ‚îÇ **Responsible**     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üü¢ Low                  ‚îÇ 10% discount +                  ‚îÇ Customer Service    ‚îÇ
‚îÇ (minor delay)           ‚îÇ shipping follow-up               ‚îÇ Representative      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üü° Medium               ‚îÇ Immediate replacement +          ‚îÇ Supervisor          ‚îÇ
‚îÇ (damaged product)       ‚îÇ apology letter                   ‚îÇ                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üî¥ High                 ‚îÇ Phone call +                     ‚îÇ Service Manager     ‚îÇ
‚îÇ (recurring issue)       ‚îÇ 30% compensation                 ‚îÇ                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

**üìã Quick Implementation Guide:**
‚Ä¢ üü¢ **Low Level:** Direct handling by representative
‚Ä¢ üü° **Medium Level:** Involve direct supervisor
‚Ä¢ üî¥ **High Level:** Immediate management intervention

üí° **Supplement Store Specific Tips**
‚Ä¢ **Medical Transparency:** Remind customers that results vary by individual, and emphasize the importance of consulting a doctor before use
‚Ä¢ **Complaint Documentation:** Create a database of recurring issues (like fragile packaging, shipping delays) to improve operations
‚Ä¢ **Training:** Train your team on basic medical terminology to accurately explain product ingredients

üìå **Complex Scenario Example**
**Customer:** "I ordered 3 bottles and they never arrived, I want my money back now!"
**Response:**
"I sincerely apologize for this unacceptable error. Here's what we'll do:
‚Ä¢ Full refund processed within 24 hours
‚Ä¢ Send a complimentary gift (sample of a new product) as an apology
‚Ä¢ Investigate with our shipping provider and inform you of the results"

üîÑ **Type "new search" to search for another topic or "end search" to return to normal chat**`;
  };

  const handleComplaintSearch = async (query: string): Promise<string> => {
    try {
      const searchQuery = query.trim();
      const lowerQuery = searchQuery.toLowerCase();
      
      // First check if it's a customer service question that needs web search
      const isCustomerServiceQuery = 
        lowerQuery.includes('ÿπŸÖŸäŸÑ') || lowerQuery.includes('customer') ||
        lowerQuery.includes('ŸÖÿ™ÿ∂ÿßŸäŸÇ') || lowerQuery.includes('angry') ||
        lowerQuery.includes('ÿßÿ™ÿπÿßŸÖŸÑ') || lowerQuery.includes('handle') ||
        lowerQuery.includes('ÿ¥ŸÉŸàŸâ') || lowerQuery.includes('complaint') ||
        lowerQuery.includes('ŸÖÿ¥ŸÉŸÑÿ©') || lowerQuery.includes('problem');

      // If it's a customer service question, perform real web search
      if (isCustomerServiceQuery) {
        try {
          // Create a search query optimized for customer service best practices
          let webSearchQuery = searchQuery;
          if (lowerQuery.includes('ÿπŸÖŸäŸÑ') || lowerQuery.includes('ŸÖÿ™ÿ∂ÿßŸäŸÇ')) {
            webSearchQuery = `customer service best practices dealing with angry upset customers ${searchQuery}`;
          } else {
            webSearchQuery = `customer service best practices ${searchQuery}`;
          }

          // Perform web search using the available web search tool
          const webSearchResults = await performWebSearch(webSearchQuery);
          
          // Format the response with bilingual support
          return formatWebSearchResponse(searchQuery, webSearchResults);
          
        } catch (error) {
          console.error('Web search failed, falling back to predefined responses:', error);
          // Fall back to predefined responses if web search fails
        }
      }
      
      if (lowerQuery.includes('refund') || lowerQuery.includes('return') || lowerQuery.includes('ÿßÿ≥ÿ™ÿ±ÿØÿßÿØ')) {
        return `üîç **Search Results for "${searchQuery}":**

üìã **Refund/Return Policy Information:**

üá¨üáß **English Response:**
"I understand you're asking about refunds. Here's what I found:
‚Ä¢ Refunds are typically processed within 5-7 business days
‚Ä¢ Items must be in original condition for returns
‚Ä¢ Keep your receipt or order number for faster processing
‚Ä¢ Contact customer service for specific cases

I can help you start a return request right now if needed."

üá∏üá¶ **Arabic Response:**
"ÿ£ŸÅŸáŸÖ ÿ£ŸÜŸÉ ÿ™ÿ≥ÿ£ŸÑ ÿπŸÜ ÿßŸÑÿßÿ≥ÿ™ÿ±ÿØÿßÿØ. ÿ•ŸÑŸäŸÉ ŸÖÿß Ÿàÿ¨ÿØÿ™Ÿá:
‚Ä¢ ÿπÿßÿØÿ© ŸÖÿß ÿ™ÿ™ŸÖ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÖÿ®ÿßŸÑÿ∫ ÿßŸÑŸÖÿ≥ÿ™ÿ±ÿØÿ© ÿÆŸÑÿßŸÑ 5-7 ÿ£ŸäÿßŸÖ ÿπŸÖŸÑ
‚Ä¢ Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ÿßŸÑÿπŸÜÿßÿµÿ± ŸÅŸä ÿ≠ÿßŸÑÿ™Ÿáÿß ÿßŸÑÿ£ÿµŸÑŸäÿ© ŸÑŸÑÿ•ÿ±ÿ¨ÿßÿπ
‚Ä¢ ÿßÿ≠ÿ™ŸÅÿ∏ ÿ®ÿ•ŸäÿµÿßŸÑŸÉ ÿ£Ÿà ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ® ŸÑŸÑŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ£ÿ≥ÿ±ÿπ
‚Ä¢ ÿßÿ™ÿµŸÑ ÿ®ÿÆÿØŸÖÿ© ÿßŸÑÿπŸÖŸÑÿßÿ° ŸÑŸÑÿ≠ÿßŸÑÿßÿ™ ÿßŸÑŸÖÿ≠ÿØÿØÿ©

ŸäŸÖŸÉŸÜŸÜŸä ŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ŸÅŸä ÿ®ÿØÿ° ÿ∑ŸÑÿ® ÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑÿ¢ŸÜ ÿ•ÿ∞ÿß ŸÑÿ≤ŸÖ ÿßŸÑÿ£ŸÖÿ±."

Need help with a specific return? Ask me more details!`;
      }
      
      if (lowerQuery.includes('shipping') || lowerQuery.includes('delivery') || lowerQuery.includes('ÿ¥ÿ≠ŸÜ') || lowerQuery.includes('ÿ™ŸàÿµŸäŸÑ')) {
        return `üîç **Search Results for "${searchQuery}":**

üì¶ **Shipping/Delivery Information:**

üá¨üáß **English Response:**
"Here's what I found about shipping:
‚Ä¢ Standard delivery: 2-5 business days
‚Ä¢ Express delivery: 1-2 business days
‚Ä¢ Free shipping on orders over 200 SAR
‚Ä¢ Track your order using the tracking number provided

Current shipping updates:
‚Ä¢ All orders are processed within 24 hours
‚Ä¢ Weekend deliveries available in major cities"

üá∏üá¶ **Arabic Response:**
"ÿ•ŸÑŸäŸÉ ŸÖÿß Ÿàÿ¨ÿØÿ™Ÿá ÿ≠ŸàŸÑ ÿßŸÑÿ¥ÿ≠ŸÜ:
‚Ä¢ ÿßŸÑÿ™ŸàÿµŸäŸÑ ÿßŸÑÿπÿßÿØŸä: 2-5 ÿ£ŸäÿßŸÖ ÿπŸÖŸÑ
‚Ä¢ ÿßŸÑÿ™ŸàÿµŸäŸÑ ÿßŸÑÿ≥ÿ±Ÿäÿπ: 1-2 ÿ£ŸäÿßŸÖ ÿπŸÖŸÑ
‚Ä¢ ÿ¥ÿ≠ŸÜ ŸÖÿ¨ÿßŸÜŸä ŸÑŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿ£ŸÉÿ´ÿ± ŸÖŸÜ 200 ÿ±ŸäÿßŸÑ
‚Ä¢ ÿ™ÿ™ÿ®ÿπ ÿ∑ŸÑÿ®ŸÉ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÖŸÇÿØŸÖ

ÿ™ÿ≠ÿØŸäÿ´ÿßÿ™ ÿßŸÑÿ¥ÿ≠ŸÜ ÿßŸÑÿ≠ÿßŸÑŸäÿ©:
‚Ä¢ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿ™ÿ™ŸÖ ŸÖÿπÿßŸÑÿ¨ÿ™Ÿáÿß ÿÆŸÑÿßŸÑ 24 ÿ≥ÿßÿπÿ©
‚Ä¢ ÿßŸÑÿ™ŸàÿµŸäŸÑ ŸÅŸä ÿπÿ∑ŸÑÿ© ŸÜŸáÿßŸäÿ© ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ ŸÖÿ™ÿßÿ≠ ŸÅŸä ÿßŸÑŸÖÿØŸÜ ÿßŸÑŸÉÿ®ÿ±Ÿâ"

Need to track a specific order? Give me your order number!`;
      }
      
      if (lowerQuery.includes('payment') || lowerQuery.includes('charge') || lowerQuery.includes('ÿØŸÅÿπ') || lowerQuery.includes('ÿ±ÿ≥ŸàŸÖ')) {
        return `üîç **Search Results for "${searchQuery}":**

üí≥ **Payment Information:**

üá¨üáß **English Response:**
"Here's payment information I found:
‚Ä¢ We accept Visa, Mastercard, and Mada cards
‚Ä¢ Cash on delivery available
‚Ä¢ No hidden fees or charges
‚Ä¢ Secure payment processing with encryption

If you see unexpected charges:
‚Ä¢ Check your email for order confirmations
‚Ä¢ Verify the merchant name on your statement
‚Ä¢ Contact us immediately for unauthorized charges"

üá∏üá¶ **Arabic Response:**
"ÿ•ŸÑŸäŸÉ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿØŸÅÿπ ÿßŸÑÿ™Ÿä Ÿàÿ¨ÿØÿ™Ÿáÿß:
‚Ä¢ ŸÜŸÇÿ®ŸÑ ÿ®ÿ∑ÿßŸÇÿßÿ™ ŸÅŸäÿ≤ÿß ŸàŸÖÿßÿ≥ÿ™ÿ±ŸÉÿßÿ±ÿØ ŸàŸÖÿØŸâ
‚Ä¢ ÿßŸÑÿØŸÅÿπ ÿπŸÜÿØ ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ ŸÖÿ™ÿßÿ≠
‚Ä¢ ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ±ÿ≥ŸàŸÖ ÿ£Ÿà ÿ™ŸÉÿßŸÑŸäŸÅ ÿÆŸÅŸäÿ©
‚Ä¢ ŸÖÿπÿßŸÑÿ¨ÿ© ÿØŸÅÿπ ÿ¢ŸÖŸÜÿ© ŸÖÿπ ÿßŸÑÿ™ÿ¥ŸÅŸäÿ±

ÿ•ÿ∞ÿß ÿ±ÿ£Ÿäÿ™ ÿ±ÿ≥ŸàŸÖÿßŸã ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÇÿπÿ©:
‚Ä¢ ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ®ÿ±ŸäÿØŸÉ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ŸÑÿ™ÿ£ŸÉŸäÿØÿßÿ™ ÿßŸÑÿ∑ŸÑÿ®
‚Ä¢ ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿ≥ŸÖ ÿßŸÑÿ™ÿßÿ¨ÿ± ŸÅŸä ŸÉÿ¥ŸÅ ÿ≠ÿ≥ÿßÿ®ŸÉ
‚Ä¢ ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß ŸÅŸàÿ±ÿßŸã ŸÑŸÑÿ±ÿ≥ŸàŸÖ ÿ∫Ÿäÿ± ÿßŸÑŸÖÿµÿ±ÿ≠ ÿ®Ÿáÿß"

Need help with a payment issue? Tell me more details!`;
      }
      
      // Generic search response for other queries
      return `üîç **Search Results for "${searchQuery}":**

Based on your question, here are some helpful resources:

üá¨üáß **English:**
‚Ä¢ Check our FAQ section for common questions
‚Ä¢ Contact customer service for personalized help
‚Ä¢ Visit our support center for detailed guides
‚Ä¢ Use live chat for immediate assistance

üá∏üá¶ **Arabic:**
‚Ä¢ ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÇÿ≥ŸÖ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ¥ÿßÿ¶ÿπÿ© ŸÑŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿπÿßŸÖÿ©
‚Ä¢ ÿßÿ™ÿµŸÑ ÿ®ÿÆÿØŸÖÿ© ÿßŸÑÿπŸÖŸÑÿßÿ° ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖÿ≥ÿßÿπÿØÿ© ÿ¥ÿÆÿµŸäÿ©
‚Ä¢ ŸÇŸÖ ÿ®ÿ≤Ÿäÿßÿ±ÿ© ŸÖÿ±ŸÉÿ≤ ÿßŸÑÿØÿπŸÖ ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ÿØŸÑÿ© ŸÖŸÅÿµŸÑÿ©
‚Ä¢ ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿØÿ±ÿØÿ¥ÿ© ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ÿßŸÑŸÅŸàÿ±Ÿäÿ©

üí° **Quick Actions:**
‚Ä¢ Type "end search" to return to normal chat
‚Ä¢ Ask another question to search again
‚Ä¢ Use specific keywords for better results

What else would you like to know?`;
      
    } catch (error) {
      throw new Error('Search temporarily unavailable');
    }
  };

  const handleSendMessage = async () => {
    if (!inputValue.trim()) return;

    // Add user message
    const userMessage: Message = {
      id: Date.now().toString(),
      content: inputValue,
      isUser: true,
      timestamp: new Date(),
      type: 'text'
    };
    setMessages(prev => [...prev, userMessage]);
    const currentInput = inputValue;
    setInputValue('');

    // If creating order, handle form input
    if (isCreatingOrder) {
      setTimeout(() => {
        handleOrderFormSubmit(currentInput);
      }, 500);
      return;
    }

    // If handling complaint search, perform web search
    if (isHandlingComplaint) {
      // Check if user wants to exit search mode
      if (currentInput.toLowerCase().includes('end search') || currentInput.toLowerCase().includes('exit') || currentInput.toLowerCase().includes('ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ®ÿ≠ÿ´')) {
        setIsHandlingComplaint(false);
        const exitMessage: Message = {
          id: (Date.now() + 1).toString(),
          content: '‚úÖ Exited search mode. I\'m back to normal chat mode. How can I help you with customer service tasks?',
          isUser: false,
          timestamp: new Date(),
          type: 'text'
        };
        setMessages(prev => [...prev, exitMessage]);
        return;
      }

      setIsTyping(true);
      setTimeout(async () => {
        try {
          const searchResponse = await handleComplaintSearch(currentInput);
          const botResponse: Message = {
            id: (Date.now() + 1).toString(),
            content: searchResponse,
            isUser: false,
            timestamp: new Date(),
            type: 'text'
          };
          setMessages(prev => [...prev, botResponse]);
        } catch (error) {
          const errorResponse: Message = {
            id: (Date.now() + 1).toString(),
            content: '‚ùå Sorry, I couldn\'t search for that right now. Please try again or contact technical support.',
            isUser: false,
            timestamp: new Date(),
            type: 'text'
          };
          setMessages(prev => [...prev, errorResponse]);
        }
        setIsTyping(false);
      }, 1000);
      return;
    }

    setIsTyping(true);

    // Generate role-specific response
    setTimeout(() => {
      const botResponse: Message = {
        id: (Date.now() + 1).toString(),
        content: generateRoleResponse(currentInput),
        isUser: false,
        timestamp: new Date(),
        type: 'text'
      };
      setMessages(prev => [...prev, botResponse]);
      setIsTyping(false);
    }, 1000 + Math.random() * 1000);
  };

  const generateRoleResponse = (userMessage: string): string => {
    const message = userMessage.toLowerCase();
    
    // Customer Service specific responses
    if (user?.position === 'Customer Service') {
      if (message.includes('order') || message.includes('create')) {
        return 'üõí I can help you create orders directly with real WooCommerce integration! Use the "Create New Order" button above, and I\'ll search for actual products and create real orders in your system.';
      }
      if (message.includes('customer') || message.includes('complaint')) {
        return 'ü§ù For customer issues: Start by acknowledging their concern, then offer solutions. Would you like specific templates for common situations?';
      }
    }

    // Copy Writing specific responses
    if (user?.position === 'Copy Writing') {
      if (message.includes('write') || message.includes('copy')) {
        return '‚úçÔ∏è Great! For effective copy, focus on benefits over features. What\'s the product and target audience? I can help craft compelling messaging.';
      }
    }

    // Media Buyer specific responses
    if (user?.position === 'Media Buyer') {
      if (message.includes('campaign') || message.includes('ads')) {
        return 'üìä Let\'s optimize your campaigns! Check your CTR, CPC, and ROAS. I can help analyze performance data and suggest improvements.';
      }
    }

    // Designer specific responses
    if (user?.position === 'Designer') {
      if (message.includes('design') || message.includes('color')) {
        return 'üé® Design tip: Use the 60-30-10 color rule for balanced visuals. What type of design are you working on? I can suggest specific approaches.';
      }
    }

    return `‚ú® As your ${roleColors.name}, I'm here to help with your role-specific tasks. What would you like assistance with?`;
  };

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  };

  const handleQuickActionsClick = () => {
    setShowQuickActions(true);
    const quickActionsMessage: Message = {
      id: Date.now().toString(),
      content: '‚ú® **Quick Actions Available:**\n\nChoose from the available actions below to get started quickly. These are personalized based on your role and position.',
      isUser: false,
      timestamp: new Date(),
      type: 'text'
    };
    setMessages(prev => [...prev, quickActionsMessage]);

    // Show the quick actions buttons after a brief delay
    setTimeout(() => {
      const actionsMessage: Message = {
        id: (Date.now() + 1).toString(),
        content: 'üéØ **Available Actions:**',
        isUser: false,
        timestamp: new Date(),
        type: 'quick_actions'
      };
      setMessages(prev => [...prev, actionsMessage]);
    }, 500);
  };

  if (!isOpen) {
  return (
    <TooltipProvider>
      <Tooltip>
        <TooltipTrigger asChild>
                      <div
              className={`
                fixed right-6 bottom-6 z-50
                w-14 h-14 rounded-full
                bg-gradient-to-r ${roleColors.gradient}
                shadow-lg hover:shadow-xl
                flex items-center justify-center
                cursor-pointer transition-all duration-300
                hover:scale-110 active:scale-95
                border-2 border-white
              `}
              onMouseEnter={() => setIsHovered(true)}
              onMouseLeave={() => setIsHovered(false)}
              onClick={() => setIsOpen(true)}
            >
              <div className="relative">
                <Bot className="h-6 w-6 text-white" />
                {/* Animated pulse effect */}
                <div className={`absolute -inset-3 rounded-full ${roleColors.pulse} opacity-20 animate-ping`}></div>
                {/* Secondary pulse */}
                <div className={`absolute -inset-1 rounded-full ${roleColors.secondaryPulse} opacity-40 animate-pulse`}></div>
              </div>
              
              {/* Notification dot */}
              <div className="absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white flex items-center justify-center">
                <div className="w-2 h-2 bg-white rounded-full animate-pulse"></div>
              </div>
            </div>
        </TooltipTrigger>
        <TooltipContent side="left" sideOffset={15} className="max-w-xs">
          <div className="flex items-center gap-3 p-1">
            <div className="flex-shrink-0">
                <div className={`w-8 h-8 rounded-full bg-gradient-to-r ${roleColors.gradient} flex items-center justify-center`}>
                <MessageCircle className="h-4 w-4 text-white" />
              </div>
            </div>
            <div>
                <div className="font-semibold text-sm text-foreground">{roleColors.name}</div>
                <div className="text-xs text-muted-foreground">üí¨ Click to chat with Noorcare!</div>
              <div className="text-xs text-muted-foreground mt-1">
                  ‚ú® Get personalized assistance
                </div>
            </div>
          </div>
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
    );
  }

      return (
      <div className={`fixed bottom-6 right-6 z-[9999] transition-all duration-500 ease-out ${isOpen ? 'animate-in slide-in-from-bottom-5' : ''}`}>
        <Card className={`w-80 sm:w-96 shadow-2xl transition-all duration-300 ${isMinimized ? 'h-16' : 'h-[500px]'} border-2`}>
        <CardHeader className={`${roleColors.bgColor} text-white p-4 rounded-t-lg relative overflow-hidden`}>
          {/* Background pattern */}
          <div className="absolute inset-0 opacity-10">
            <div className="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-white/20 to-transparent"></div>
          </div>
          
          <div className="flex items-center justify-between relative z-10">
            <div className="flex items-center gap-3">
              <div className="relative">
                <div className={`w-10 h-10 rounded-full bg-white/20 flex items-center justify-center`}>
                  <roleColors.icon className="h-5 w-5 text-white" />
                </div>
                <div className="absolute -top-1 -right-1 w-4 h-4 bg-green-400 rounded-full border-2 border-white">
                  <div className="w-full h-full bg-green-500 rounded-full animate-pulse"></div>
                </div>
              </div>
              <div>
                <CardTitle className="text-lg font-bold">Noorcare AI</CardTitle>
                <p className="text-sm opacity-90">{user?.position || 'Admin'} Assistant</p>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <Button
                variant="ghost"
                size="sm"
                onClick={() => setIsMinimized(!isMinimized)}
                className="h-8 w-8 p-0 text-white hover:bg-white/20 transition-colors"
              >
                {isMinimized ? <Maximize2 className="h-4 w-4" /> : <Minimize2 className="h-4 w-4" />}
              </Button>
              <Button
                variant="ghost"
                size="sm"
                onClick={() => setIsOpen(false)}
                className="h-8 w-8 p-0 text-white hover:bg-white/20 transition-colors"
              >
                <X className="h-4 w-4" />
              </Button>
            </div>
          </div>
        </CardHeader>

        {!isMinimized && (
          <CardContent className="p-0 h-[420px] flex flex-col bg-gradient-to-b from-gray-50 to-white">
            <ScrollArea className="flex-1 p-4">
              <div className="space-y-4">
                {messages.map((message) => (
                  <div
                    key={message.id}
                    className={`flex ${message.isUser ? 'justify-end' : 'justify-start'} animate-in fade-in slide-in-from-bottom-2 duration-300`}
                  >
                    <div
                      className={`max-w-[85%] p-4 rounded-2xl shadow-sm ${
                        message.isUser
                          ? 'bg-white text-gray-800 border border-gray-200'
                          : `${roleColors.bgColor} text-white`
                      }`}
                    >
                      <p className="text-sm whitespace-pre-line leading-relaxed">{message.content}</p>
                      
                      {/* Product Selection Buttons */}
                      {message.type === 'product_selection' && message.productData?.products && (
                        <div className="mt-4 space-y-3">
                          {message.productData.products.map((product: WooCommerceProduct) => (
                            <div key={product.id} className="bg-white/10 backdrop-blur-sm rounded-lg p-3 border border-white/20">
                              <div className="flex items-start gap-3">
                                {product.images && product.images[0] && (
                                  <img 
                                    src={product.images[0].src} 
                                    alt={product.name}
                                    className="w-12 h-12 rounded-lg object-cover flex-shrink-0"
                                  />
                                )}
                                <div className="flex-1 min-w-0">
                                  <h4 className="text-sm font-medium text-white truncate">{product.name}</h4>
                                  <p className="text-xs text-white/80 mt-1">
                                    {product.sale_price ? (
                                      <>
                                        <span className="line-through">{product.price} SAR</span>
                                        <span className="ml-2 font-semibold">{product.sale_price} SAR</span>
                                      </>
                                    ) : (
                                      <span className="font-semibold">{product.price} SAR</span>
                                    )}
                                  </p>
                                  <Button
                                    size="sm"
                                    onClick={() => handleProductSelection(product)}
                                    className="mt-2 bg-white text-gray-800 hover:bg-gray-100 h-7 px-3 text-xs"
                                  >
                                    Select This Product
                                  </Button>
                                </div>
                              </div>
                            </div>
                          ))}
                          <Button
                            size="sm"
                            variant="outline"
                            onClick={() => {
                              const userMessage: Message = {
                                id: Date.now().toString(),
                                content: 'search again',
                                isUser: true,
                                timestamp: new Date(),
                                type: 'text'
                              };
                              setMessages(prev => [...prev, userMessage]);
                              setTimeout(() => {
                                handleOrderFormSubmit('search again');
                              }, 500);
                            }}
                            className="w-full bg-white/20 text-white border-white/30 hover:bg-white/30 h-8"
                          >
                            üîç Search for Different Products
                          </Button>
                        </div>
                      )}

                      {/* Quick Actions Buttons */}
                      {message.type === 'quick_actions' && (
                        <div className="mt-4 space-y-2">
                          {getRoleSpecificActions().map((action, index) => {
                            const isPending = pendingActions.has(action.action);
                            return (
                              <Button
                                key={index}
                                variant="outline"
                                size="sm"
                                onClick={() => handleRoleAction(action.action)}
                                disabled={isPending || isTyping}
                                className={`w-full text-left justify-start text-sm h-auto py-3 px-4 bg-white/20 text-white border-white/30 hover:bg-white/30 transition-all duration-200 hover:scale-[1.02] hover:shadow-md ${
                                  isPending ? 'opacity-50 cursor-not-allowed' : ''
                                }`}
                              >
                                <action.icon className="h-4 w-4 mr-3" />
                                {isPending ? '‚è≥ Processing...' : action.label}
                              </Button>
                            );
                          })}
                        </div>
                      )}
                      
                      <p className="text-xs opacity-70 mt-2">
                        {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                      </p>
                    </div>
                  </div>
                ))}

                {isTyping && (
                  <div className="flex justify-start animate-in fade-in duration-300">
                    <div className={`${roleColors.bgColor} text-white p-4 rounded-2xl shadow-sm`}>
                      <div className="flex space-x-2 items-center">
                        <div className="flex space-x-1">
                          <div className="w-2 h-2 bg-white/70 rounded-full animate-bounce"></div>
                          <div className="w-2 h-2 bg-white/70 rounded-full animate-bounce" style={{ animationDelay: '0.15s' }}></div>
                          <div className="w-2 h-2 bg-white/70 rounded-full animate-bounce" style={{ animationDelay: '0.3s' }}></div>
                        </div>
                        <span className="text-xs opacity-70">Noorcare is typing...</span>
                      </div>
                    </div>
                  </div>
                )}

                {isSearchingProducts && (
                  <div className="flex justify-start animate-in fade-in duration-300">
                    <div className={`${roleColors.bgColor} text-white p-4 rounded-2xl shadow-sm`}>
                      <div className="flex space-x-2 items-center">
                        <Search className="h-4 w-4 animate-spin" />
                        <span className="text-xs opacity-70">Searching WooCommerce products...</span>
                      </div>
                    </div>
                  </div>
                )}

                {messages.length <= 1 && !isTyping && (
                  <div className="space-y-3 animate-in fade-in duration-500 delay-300">
                    <p className="text-sm text-gray-600 font-semibold">‚ú® Quick Actions:</p>
                    {getRoleSpecificActions().map((action, index) => {
                      const isPending = pendingActions.has(action.action);
                      return (
                        <Button
                          key={index}
                          variant="outline"
                          size="sm"
                          onClick={() => handleRoleAction(action.action)}
                          disabled={isPending || isTyping}
                          className={`w-full text-left justify-start text-sm h-auto py-3 px-4 ${roleColors.textColor} border-current transition-all duration-200 hover:bg-sky-400 hover:text-white hover:scale-[1.02] hover:shadow-md ${
                            isPending ? 'opacity-50 cursor-not-allowed' : ''
                          }`}
                        >
                          <action.icon className="h-4 w-4 mr-3" />
                          {isPending ? '‚è≥ Processing...' : action.label}
                        </Button>
                      );
                    })}
                  </div>
                )}
              </div>
              <div ref={messagesEndRef} />
            </ScrollArea>

            <div className="p-4 border-t bg-white">
              <div className="flex gap-2">
                <Button
                  onClick={handleQuickActionsClick}
                  disabled={isTyping || isSearchingProducts}
                  variant="outline"
                  className="rounded-full w-12 h-12 p-0 border-2 hover:bg-sky-50 transition-all duration-200 hover:scale-105"
                  title="Show Quick Actions"
                >
                  <Zap className="h-5 w-5 text-sky-600" />
                </Button>
                <Input
                  value={inputValue}
                  onChange={(e) => setInputValue(e.target.value)}
                  onKeyPress={handleKeyPress}
                  placeholder={
                    isCreatingOrder 
                      ? `Enter ${createOrderSteps[orderForm.currentStep]?.label.toLowerCase()}...`
                      : `Ask Noorcare anything...`
                  }
                  className="flex-1 rounded-full border-2 focus:border-current transition-colors"
                  disabled={isTyping || isSearchingProducts}
                />
                <Button
                  onClick={handleSendMessage}
                  disabled={!inputValue.trim() || isTyping || isSearchingProducts}
                  className={`${roleColors.bgColor} hover:opacity-90 text-white rounded-full w-12 h-12 p-0 transition-all duration-200 hover:scale-105`}
                >
                  <Send className="h-5 w-5" />
                </Button>
              </div>
              {isCreatingOrder && (
                <div className="mt-2 text-xs text-gray-500 text-center">
                  Step {orderForm.currentStep + 1} of {createOrderSteps.length} ‚Ä¢ Creating Real Order
                </div>
              )}
            </div>
          </CardContent>
        )}
      </Card>
    </div>
  );
};

export default FloatingChatbot; 